
# 数据复制
## 1. 领导者与追随者
### 1.1同步复制与异步复制
### 1.2设置新从库
### 1.3处理节点宕机
#### 1.3.1从库失效：追赶恢复
#### 1.3.2主库失效：故障切换
### 1.4复制日志的实现
#### 1.4.1基于语句的复制
sql语句执行结果是不确定的
- 调用 **非确定性函数** ，例如 `NOW()` 获取当前日期时间，或使用 `RAND()` 获取一个随机数
- 语句使用了 **自增列（auto increment）**，或者根据现有数据，更新当前数据
- 有副作用的语句（例如：触发器、存储过程、用户定义的函数）可能会在每个副本上产生不同的副作用，除非副作用是绝对确定性的
#### 1.4.2传输预写式日志（WAL）
与底层数据库使用的存储引擎有关，如果数据库新旧版本，底层存储方式发生变更，这种方式无法解决
#### 1.4.3逻辑日志复制（基于行）
关系数据库的逻辑日志通常是以行的粒度来描述对数据库表的写入记录的序列：

-   对于插入的行，日志包含所有列的新值。
-   对于删除的行，日志包含足够的信息来唯一标识被删除的行，这通常是主键，但如果表上没有主键，则需要记录所有列的旧值。
-   对于更新的行，日志包含足够的信息来唯一标识被更新的行，以及所有列的新值（或至少所有已更改的列的新值）。

#### 1.4.4基于触发器的复制
上面都是数据库内部实现的复制机制，可以将复制操作上移到应用程序层，由应用程序实现。。

## 2. 复制延迟问题
